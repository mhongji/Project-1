---
title: "Project 1"
author: 
  - Hongjing Mao
  - Yuhan Hu
date: "2025-06-14"
format: pdf
editor: visual
---

## Step 1: Data preprocessing

```{r}
library(tidyverse)

url <- "https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv"

edu01a <- read_csv(url, show_col_types = FALSE) %>% 
  select(
    area_name = Area_name,   
    STCOU,
    ends_with("D")          
  )

head(edu01a, 5)              
```

## Step 2: wide string to long string

```{r}
library(tidyr)
edu01a_long <- edu01a %>% 
  pivot_longer(
    cols  = -c(area_name, STCOU),   
    names_to  = "raw_var",          
    values_to = "enrollment",       
    values_drop_na = TRUE          
  )
head(edu01a_long, 5)               
```

## Step 3: Parse variable name string

```{r}
long_updated <- edu01a_long %>% 
  mutate(
    # last two digits before the "D"
    yr_two      = substr(raw_var, nchar(raw_var) - 2, nchar(raw_var) - 1),  # e.g. "97" or "02"
    year        = as.integer(
                   if_else(as.integer(yr_two) <= 30,  
                           paste0("20", yr_two),
                           paste0("19", yr_two))      
                 ),
    measurement = substr(raw_var, 1, 7)               
  ) %>% 
  select(-yr_two)                                     

head(long_updated, 5)
```

## Step 4: Separate county vs non-county data & add classes

```{r}
library(dplyr)
library(stringr)

county_idx <- grep(", \\w\\w$", long_updated$area_name)

county_tibble <- long_updated[county_idx, ] %>% 
  mutate(area_name = str_trim(area_name))          
class(county_tibble) <- c("county", class(county_tibble))

state_tibble  <- long_updated[-county_idx, ]
class(state_tibble)  <- c("state",  class(state_tibble))

# quick check: first 10 rows of each
head(county_tibble, 10)
head(state_tibble,  10)
```

## Step 5: Create new variable

```{r}
library(stringr)
new_county_tibble <- county_tibble %>% 
  mutate(
    state = str_sub(area_name, -2, -1) 
  )
head(new_county_tibble, 10)
```

## Step 6: Create new "division" variables

```{r}
state_division <- c(
  "CONNECTICUT" = "New England", "MAINE" = "New England", "MASSACHUSETTS" = "New England",
  "NEW HAMPSHIRE" = "New England", "RHODE ISLAND" = "New England", "VERMONT" = "New England",
  
  "NEW JERSEY" = "Mid-Atlantic", "NEW YORK" = "Mid-Atlantic", "PENNSYLVANIA" = "Mid-Atlantic",
  
  "ILLINOIS" = "East North Central", "INDIANA" = "East North Central", "MICHIGAN" = "East North Central",
  "OHIO" = "East North Central", "WISCONSIN" = "East North Central",
  
  "IOWA" = "West North Central", "KANSAS" = "West North Central", "MINNESOTA" = "West North Central",
  "MISSOURI" = "West North Central", "NEBRASKA" = "West North Central",
  "NORTH DAKOTA" = "West North Central", "SOUTH DAKOTA" = "West North Central",
  
  "DELAWARE" = "South Atlantic", "DISTRICT OF COLUMBIA" = "South Atlantic", "District of Columbia" = "South Atlantic", "FLORIDA" = "South Atlantic",
  "GEORGIA" = "South Atlantic", "MARYLAND" = "South Atlantic", "NORTH CAROLINA" = "South Atlantic",
  "SOUTH CAROLINA" = "South Atlantic", "VIRGINIA" = "South Atlantic", "WEST VIRGINIA" = "South Atlantic",
  
  "ALABAMA" = "East South Central", "KENTUCKY" = "East South Central",
  "MISSISSIPPI" = "East South Central", "TENNESSEE" = "East South Central",
  
  "ARKANSAS" = "West South Central", "LOUISIANA" = "West South Central",
  "OKLAHOMA" = "West South Central", "TEXAS" = "West South Central",
  
  "ARIZONA" = "Mountain", "COLORADO" = "Mountain", "IDAHO" = "Mountain",
  "MONTANA" = "Mountain", "NEVADA" = "Mountain", "NEW MEXICO" = "Mountain",
  "UTAH" = "Mountain", "WYOMING" = "Mountain",
  
  "ALASKA" = "Pacific", "CALIFORNIA" = "Pacific", "HAWAII" = "Pacific",
  "OREGON" = "Pacific", "WASHINGTON" = "Pacific"
)


# 2. Create division column in your non-county tibble
division <- state_tibble %>%
  mutate(
    division = if_else(
      area_name %in% names(state_division),
      state_division[area_name],
      "ERROR"
    )
  )
# Show example with "UNITED STATES"
head(division)
```

